class MainController < ApplicationController
  layout "member"
  def index
    @records = Record.find_all_wake_up_today(params[:page])
  end

  def register
    if request.post?
      @user = User.new(params[:user])
      if @user.save
        flash[:info] = '註冊成功了'
        session[:uid] = @user.id
        redirect_to :controller => 'member',:action => 'index'
      end
    end
  end

  def login
    if request.method == :post
      if @user = User.authenticate(params[:user])
        session[:uid] = @user.id

        uri = session[:original_uri]
        session[:original_uri] = nil

        if params[:remember] == '1'
          cookies[:user_pass] = @user.gen_cookie
        else
          cookies.delete(:user_pass)
        end 

        redirect_to(uri || {:controller => :member, :action => :index})
      else
        flash[:notice] = '名字或是密碼錯了喔'
      end
    end
  end

  def logout
    cookies.delete(:user_pass)
    reset_session
    flash[:info] = 'You have logged out'

    redirect_to :controller => 'main', :action => 'index'
  end

end
